<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <title>Document</title>
  </head>
  <body>
    <div class="max-w-lg m-auto text-center">
      <form
        class="bg-white shadow-md rounded px-8 pt-6 pb-8 mt-20"
        name="myform"
        method="dialog"
      >
        <input
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
          type="submit"
          onclick="logout()"
          value="Logout"
        />
        <h1
          class="text-3xl md:text-4xl text-indigo-400 mt-2 font-medium mb-2"
          id="welcome"
        ></h1>
        <input
          class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          id="city"
          type="text"
          placeholder="enter your city"
        />
        <input
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 mt-2 flex self-start rounded focus:outline-none focus:shadow-outline"
          type="submit"
          onclick="weatherForcast()"
          value="know weather"
        />
        <div id="weatherDetails"></div>
      </form>
    </div>
    <script>
      // let html = "";
      // let htmlSegment = `Welcome ${(localStorage.getItem('user'))}`;
      // html += htmlSegment;
      // let message = document.querySelector("#welcome");
      document.querySelector(
        "#welcome"
      ).innerHTML = `Welcome <p class="text-center text-red-700">
        ${localStorage.getItem("user")}
          </p>`;
      async function weatherForcast() {
        try {
          let weatherStatus = [];
          const res = await fetch(
            `http://api.openweathermap.org/geo/1.0/direct?q=${
              document.getElementById("city").value
            }&appid=6025a845412af7e1bbdc140449943184`
          );
          //console.log(res);

          const [{ lat, lon }] = await res.json();
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=6025a845412af7e1bbdc140449943184`
          );

          const {
            name,
            sys: { country },
            main: { temp, temp_min, temp_max, feels_like },
            weather: [{ description }],
          } = await response.json();

          // weatherStatus.push({
          //   name,
          //   country,
          //   temp,
          //   temp_min,
          //   temp_max,
          //   feels_like,
          //   description,
          // });
          // other than push
          weatherStatus = [
            ...weatherStatus,
            {
              name,
              country,
              temp,
              temp_min,
              temp_max,
              feels_like,
              description,
            },
          ];

          const dashboardData = document.createElement("div");
          const dashboardContainer = document.getElementById("weatherDetails");
          let display = weatherStatus.map((ele) => {
            return (dashboardData.innerHTML = `<div><h2 class="text-sm md:text-xl mb-4">City Name: ${ele.name}</h2>
                <h2 class="text-sm md:text-xl mb-4">Description: ${ele.description}</h2>
               <h3 class="text-sm md:text-xl mb-4">Current Temperature: ${ele.temp}</h3>
               <h4 class="text-sm md:text-xl mb-4">Maximum Temperature: ${ele.temp_max}</h4>
               <h5 class="text-sm md:text-xl mb-4">Minimun Temperature: ${ele.temp_min}</h5>
               <h6 class="text-sm md:text-xl mb-4">Feels like: ${ele.feels_like}</h6>
               <h5 class="text-sm md:text-xl mb-4">Country: ${ele.country}</h5>`);
          });
          dashboardContainer.innerHTML = display;
        } catch (err) {
          console.log(err);
        }
      }

      function logout() {
        window.addEventListener("click", function () {
          document.location.href = "./index.html";
          alert("Are you sure?");
        });
      }
    </script>
  </body>
</html>
